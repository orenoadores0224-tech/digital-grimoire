<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>MIND_OS KERNEL</title>
  <style>
    :root {
      --bg: #000000;
      --term: #0f0; /* Terminal Green */
      --warn: #ff00ff;
      --dim: #005500;
    }
    body {
      background-color: var(--bg);
      color: var(--term);
      font-family: "Courier New", Courier, monospace;
      margin: 0;
      padding: 20px;
      padding-bottom: 80px;
      overflow-x: hidden;
      line-height: 1.4;
    }
    
    /* CRTモニター風のエフェクト */
    body::before {
      content: " ";
      display: block;
      position: fixed; top: 0; left: 0; bottom: 0; right: 0;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
      z-index: 2; background-size: 100% 2px, 3px 100%; pointer-events: none;
    }

    a { color: var(--term); text-decoration: none; border-bottom: 1px dashed var(--term); }
    h1 { font-size: 20px; border-bottom: 2px solid var(--term); padding-bottom: 10px; margin-bottom: 20px; }
    
    .nav-btn {
      position: absolute; top: 20px; right: 20px;
      border: 1px solid var(--term); padding: 5px 10px; font-size: 12px;
    }

    /* === ターミナルエリア === */
    .terminal-window {
      border: 1px solid var(--dim); padding: 10px; margin-bottom: 20px; min-height: 150px;
      font-size: 14px; white-space: pre-wrap;
    }
    .cursor {
      display: inline-block; width: 10px; height: 16px; background: var(--term);
      animation: blink 1s infinite; vertical-align: middle;
    }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

    /* === コマンドボタン群 === */
    .command-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-bottom: 30px; }
    .cmd-btn {
      background: #001100; border: 1px solid var(--term); color: var(--term);
      padding: 12px; text-align: left; font-family: inherit; cursor: pointer;
      transition: 0.2s; position: relative;
    }
    .cmd-btn:hover { background: var(--term); color: #000; }
    .cmd-btn::before { content: "> "; }

    /* === 定義書き換えフォーム === */
    .input-group { margin-bottom: 10px; border: 1px solid var(--dim); padding: 10px; }
    .input-label { font-size: 12px; color: #008800; margin-bottom: 5px; }
    input[type="text"] {
      background: transparent; border: none; border-bottom: 1px solid var(--term);
      color: var(--term); font-family: inherit; width: 100%; font-size: 16px;
      outline: none;
    }

    /* === 虚無モード === */
    #voidOverlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; z-index: 9999; display: none;
      align-items: center; justify-content: center; flex-direction: column;
    }
    .void-text { color: #333; font-size: 12px; }

  </style>
</head>
<body>

  <a href="./index.html" class="nav-btn">EXIT_KERNEL</a>

  <h1>MIND_OS KERNEL v2.0</h1>

  <div class="terminal-window" id="consoleOutput">
    > SYSTEM READY...<br>
    > WAITING FOR INPUT...<span class="cursor"></span>
  </div>

  <div class="command-grid">
    <button class="cmd-btn" onclick="runReboot()">EXECUTE: FULL_REBOOT.exe</button>
    <button class="cmd-btn" onclick="openRewriter()">EXECUTE: DEFINE_REWRITE.sh</button>
    <button class="cmd-btn" onclick="enterVoid()">ENTER: VOID_MODE (Null)</button>
  </div>

  <div id="rewriteArea" style="display:none;">
    <div style="margin-bottom:10px; color:var(--warn);">// WARNING: CORE VALUES WILL BE OVERWRITTEN</div>
    
    <div class="input-group">
      <div class="input-label">TARGET VARIABLE (対象の言葉)</div>
      <input type="text" id="targetWord" placeholder="例: 緊張 (ANXIETY)">
    </div>

    <div class="input-group">
      <div class="input-label">NEW DEFINITION (新しい定義)</div>
      <input type="text" id="newDef" placeholder="例: エネルギーの充填 (POWER_CHARGE)">
    </div>

    <button class="cmd-btn" onclick="commitRewrite()">>> COMMIT CHANGES (書き換え実行)</button>
  </div>

  <div id="voidOverlay" onclick="exitVoid()">
    <div class="void-text">SYSTEM SUSPENDED</div>
    <div class="void-text" style="margin-top:20px;">Touch to Resume</div>
  </div>

  <script>
    // === ユーティリティ: タイプライター風出力 ===
    const consoleEl = document.getElementById('consoleOutput');
    let isTyping = false;

    function log(text, speed = 30) {
      if(isTyping) return;
      isTyping = true;
      consoleEl.innerHTML = "> "; // リセット
      let i = 0;
      const interval = setInterval(() => {
        consoleEl.innerHTML += text.charAt(i);
        i++;
        if (i >= text.length) {
          clearInterval(interval);
          consoleEl.innerHTML += '<span class="cursor"></span>';
          isTyping = false;
        }
      }, speed);
    }

    function fastLog(html) {
      consoleEl.innerHTML = html + '<span class="cursor"></span>';
    }

    // === 1. 再起動スクリプト (脳内OS再起動) ===
    function runReboot() {
      const sequence = [
        "INITIATING SHUTDOWN SEQUENCE...",
        "DISCONNECTING: Visual Cortex (視覚)... [OK]",
        "DISCONNECTING: Auditory Input (聴覚)... [OK]",
        "CLEARING: Short-term Memory Cache... [OK]",
        "Loading Base Kernel... 山口式構造.sys",
        "Checking Axis... CENTERED",
        "Checking Torque... ROTATING",
        ">> SYSTEM REBOOT COMPLETED. WELCOME BACK, USER."
      ];

      let step = 0;
      consoleEl.innerHTML = "";
      
      function nextStep() {
        if (step < sequence.length) {
          consoleEl.innerHTML += "> " + sequence[step] + "<br>";
          step++;
          setTimeout(nextStep, 800 + Math.random() * 500); // ランダムな待機時間
        } else {
          consoleEl.innerHTML += '<span class="cursor"></span>';
          // 完了時にRPGのEXPを加算する連携も可能
          // localStorage.setItem('grimoire_exp', parseInt(localStorage.getItem('grimoire_exp')) + 100);
        }
      }
      nextStep();
    }

    // === 2. 定義書き換え (言語力学) ===
    function openRewriter() {
      document.getElementById('rewriteArea').style.display = 'block';
      fastLog("> ACCESSING DICTIONARY DATABASE...<br>> READY TO OVERWRITE.");
    }

    function commitRewrite() {
      const target = document.getElementById('targetWord').value;
      const def = document.getElementById('newDef').value;
      
      if(!target || !def) {
        log("ERROR: MISSING ARGUMENTS.");
        return;
      }

      // 演出
      const txt = `> TARGET: "${target}"\n> OLD_VAL: UNKNOWN_FEAR\n> OVERWRITING...\n> NEW_VAL: "${def}"\n> SUCCESS: Reality Vector Updated.`;
      
      // コンソールにゆっくり表示
      let i = 0;
      consoleEl.innerHTML = "";
      const timer = setInterval(() => {
        if(txt.charAt(i) === "\n") consoleEl.innerHTML += "<br>";
        else consoleEl.innerHTML += txt.charAt(i);
        i++;
        if(i >= txt.length) {
          clearInterval(timer);
          consoleEl.innerHTML += '<span class="cursor"></span>';
          document.getElementById('rewriteArea').style.display = 'none';
          document.getElementById('targetWord').value = "";
          document.getElementById('newDef').value = "";
        }
      }, 30);
    }

    // === 3. 虚無モード (Void) ===
    function enterVoid() {
      document.getElementById('voidOverlay').style.display = 'flex';
      // 実際にはここで数分間のタイマーを動かしても良い
    }
    
    function exitVoid() {
      document.getElementById('voidOverlay').style.display = 'none';
      fastLog("> SYSTEM RESUMED FROM VOID STATE.");
    }

  </script>
</body>
</html>
