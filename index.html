<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>GRIMOIRE RPG</title>
  <style>
    :root{
      --bg: #0b0d10;
      --text: #e9edf2;
      --gold: #c5a365;
      --red: #ff4a4a;
      --bar-bg: #1a1f29;
      --glass: rgba(255, 255, 255, 0.05);
      --glass-hover: rgba(255, 255, 255, 0.1);
    }
    body {
      margin: 0;
      font-family: "Hiragino Mincho ProN", serif;
      background: var(--bg);
      color: var(--text);
      padding-top: 70px;
      padding-bottom: 80px;
      overflow-x: hidden;
    }

    /* === HUD === */
    .hud-bar {
      position: fixed;
      top: 0; left: 0; width: 100%;
      height: 60px;
      background: rgba(11, 13, 16, 0.95);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      z-index: 1000;
      display: flex;
      align-items: center;
      padding: 0 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      box-sizing: border-box;
    }
    .level-circle {
      width: 44px; height: 44px;
      border: 2px solid var(--gold);
      border-radius: 50%;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      background: #000;
      font-size: 9px; color: var(--gold);
      margin-right: 12px;
      flex-shrink: 0;
    }
    .level-num { font-size: 20px; font-weight: bold; line-height: 1; }
    .exp-container { flex: 1; }
    .exp-label { font-size: 10px; color: #888; display: flex; justify-content: space-between; margin-bottom: 4px; }
    .exp-bar-bg {
      height: 6px; background: var(--bar-bg); border-radius: 3px; overflow: hidden;
    }
    .exp-bar-fill {
      height: 100%; background: linear-gradient(90deg, #c5a365, #f9d423);
      width: 0%; transition: width 0.5s ease-out;
    }

    /* === ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ === */
    main { max-width: 600px; margin: 0 auto; padding: 20px 16px; }
    h1 { font-size: 22px; text-align: center; margin-bottom: 30px; color: var(--gold); letter-spacing: 0.2em; text-shadow: 0 0 10px rgba(197, 163, 101, 0.3); }
    
    .section-title {
      font-size: 14px; color: #888; margin: 30px 0 10px; border-bottom: 1px solid #333; padding-bottom: 5px;
    }

    .card {
      background: var(--glass);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      transition: all 0.2s;
    }
    .card:active { transform: scale(0.98); background: var(--glass-hover); }
    
    .card h3 { margin: 0 0 5px 0; font-size: 16px; color: var(--text); }
    .card p { margin: 0; font-size: 12px; color: #aaa; line-height: 1.5; }
    .card .tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 10px; margin-bottom: 8px; border: 1px solid #444; }

    /* === ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼å›³é‘‘ === */
    .monster-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .monster-card { 
      background: #151515; border: 1px solid #333; padding: 10px; border-radius: 6px; text-align: center; position: relative;
    }
    .monster-icon { font-size: 24px; margin-bottom: 5px; filter: grayscale(100%); transition: 0.3s; }
    .monster-card.collected .monster-icon { filter: grayscale(0%); text-shadow: 0 0 10px var(--red); }
    .monster-name { font-size: 12px; font-weight: bold; }
    .monster-weakness { font-size: 10px; color: #ff6b6b; margin-top: 4px; display: none; }
    .monster-card.collected .monster-weakness { display: block; }

    /* === è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆ === */
    .equip-slot {
      display: flex; align-items: center; background: #1a1a1a; border: 1px solid #444; 
      padding: 10px; border-radius: 6px; margin-bottom: 8px;
    }
    .equip-icon { width: 40px; height: 40px; background: #000; display: flex; align-items: center; justify-content: center; font-size: 20px; margin-right: 12px; border: 1px solid #555; }
    .equip-info { flex: 1; }
    .equip-btn { 
      background: transparent; border: 1px solid var(--gold); color: var(--gold); 
      padding: 4px 10px; font-size: 10px; border-radius: 20px;
    }
    .equip-btn.equipped { background: var(--gold); color: #000; }

    /* === ä¹å­—åˆ‡ã‚Š === */
    .kuji-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; max-width: 240px; margin: 20px auto; }
    .kuji-cell { 
      aspect-ratio: 1; border: 1px solid #555; display: flex; align-items: center; justify-content: center; 
      border-radius: 4px; font-size: 18px; color: #666; transition: 0.1s;
    }
    .kuji-cell.active { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); border-color: var(--gold); transform: scale(1.05); }

    /* === ãƒ¢ãƒ¼ãƒ€ãƒ« === */
    .modal-overlay {
      position: fixed; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.85); z-index: 2000;
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: 0.3s;
    }
    .modal-overlay.show { opacity: 1; pointer-events: auto; }
    .modal-box {
      background: #111; border: 1px solid var(--gold); padding: 24px; border-radius: 12px;
      width: 85%; max-width: 320px; text-align: center;
      box-shadow: 0 0 30px rgba(197, 163, 101, 0.2);
    }
    .modal-title { color: var(--gold); font-size: 18px; margin-bottom: 12px; font-weight: bold; }
    .modal-text { font-size: 13px; line-height: 1.6; color: #ccc; margin-bottom: 20px; text-align: left; }
    .modal-btn {
      background: var(--gold); color: #000; border: none; padding: 10px 30px; font-weight: bold; border-radius: 30px; cursor: pointer;
    }

    /* å°å° */
    .locked-content { opacity: 0.4; pointer-events: none; filter: blur(2px); }
  </style>
</head>
<body>

  <div class="hud-bar">
    <div class="level-circle">
      <span>Lv.</span>
      <span class="level-num" id="currentLevel">1</span>
    </div>
    <div class="exp-container">
      <div class="exp-label">
        <span>MENTAL EXP</span>
        <span id="expText">0 / 100</span>
      </div>
      <div class="exp-bar-bg">
        <div class="exp-bar-fill" id="expBar"></div>
      </div>
    </div>
  </div>

  <main>
    <h1>GRIMOIRE</h1>

    <div class="card">
      <div class="tag" style="color:#aaa; border-color:#aaa;">å„€å¼é­”æ³•</div>
      <h3>æ—©ä¹å­—ï¼ˆãƒãƒ¤ã‚¯ã‚¸ï¼‰</h3>
      <p>é †ã«ã‚¿ãƒƒãƒ—ã—ã€è„³ã®ãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ¡ãƒ¢ãƒªã‚’å¼·åˆ¶å æœ‰ã™ã‚‹ã€‚</p>
      <div class="kuji-grid" id="kujiGrid"></div>
      <div id="kujiLabel" style="text-align:center; font-size:12px; height:20px; color:var(--gold); margin-top:10px;"></div>
    </div>

    <div class="section-title">EQUIPMENT (èº«ä½“æ“ä½œ)</div>
    <div id="equipmentList">
      </div>

    <div class="section-title">BESTIARY (è¦³æ¸¬ã•ã‚ŒãŸé¬¼)</div>
    <div class="monster-list" id="monsterList">
      </div>
    
    <div style="text-align:center; margin-top:40px; margin-bottom: 20px;">
      <a href="https://ameblo.jp/orenoadores0224yj/" target="_blank" style="color:#666; font-size:12px; text-decoration:none; border-bottom:1px solid #444;">
        å¤œ21æ™‚ã®æ–‡è„ˆç·¨é›†å®¤ã¸ (Login) ï¼
      </a>
    </div>

  </main>

  <div class="modal-overlay" id="dailyModal">
    <div class="modal-box">
      <div class="modal-title">DAILY QUEST</div>
      <div class="modal-text" id="dailyQuestText">
        </div>
      <button class="modal-btn" onclick="acceptQuest()">æ‰¿è«¾ã™ã‚‹</button>
    </div>
  </div>

  <div class="modal-overlay" id="levelupModal">
    <div class="modal-box" style="border-color:#4facfe;">
      <div class="modal-title" style="color:#4facfe;">LEVEL UP!</div>
      <div class="modal-text" style="text-align:center;">
        ç²¾ç¥éšæ¢¯ãŒä¸Šæ˜‡ã—ã¾ã—ãŸã€‚<br>
        æ–°ãŸãªé ˜åŸŸãŒè§£æ”¾ã•ã‚Œã¾ã™ã€‚
      </div>
      <button class="modal-btn" style="background:#4facfe;" onclick="closeLevelUp()">ç¢ºèª</button>
    </div>
  </div>

  <script>
    // === ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆã“ã“ã‚’ã„ã˜ã‚‹ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå¤‰ã‚ã‚Šã¾ã™ï¼‰ ===
    
    // ãƒ‡ã‚¤ãƒªãƒ¼ã‚¯ã‚¨ã‚¹ãƒˆã®ãƒªã‚¹ãƒˆ
    const QUESTS = [
      { title: "ã€è¦³æ¸¬ã€‘èµ¤ã®æ¢ç´¢", desc: "ä»Šæ—¥1æ—¥ã€è¦–ç•Œã«å…¥ã‚‹ã€Œèµ¤ã„ã‚‚ã®ã€ã‚’å…¨ã¦ã‚¢ã‚¤ãƒ†ãƒ ã¨ã—ã¦èªè­˜ã›ã‚ˆã€‚<br>å ±é…¬ï¼šè„³å†…ãƒ•ã‚£ãƒ«ã‚¿ã®ãƒªã‚»ãƒƒãƒˆ" },
      { title: "ã€å¯¾äººã€‘NPCã¸ã®æŒ¨æ‹¶", desc: "ã‚³ãƒ³ãƒ“ãƒ‹åº—å“¡ã‚„åŒåƒšã‚’ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é€²è¡Œã«å¿…è¦ãªNPCã¨è¦‹ãªã—ã€ç›®ã‚’è¦‹ã¦ã€Œã‚ã‚ŠãŒã¨ã†ã€ã¨è¨€ãˆã€‚<br>å ±é…¬ï¼šå¯¾äººææ€–ãƒ‡ãƒãƒ•ã®è§£é™¤" },
      { title: "ã€èº«ä½“ã€‘è¸µï¼ˆã‹ã‹ã¨ï¼‰ã®ã‚¢ãƒ³ã‚«ãƒ¼", desc: "ä¿¡å·å¾…ã¡ã®é–“ã€é‡å¿ƒã‚’è¸µã«è½ã¨ã—ã€åœ°çƒã¨æ¥ç¶šã›ã‚ˆã€‚<br>å ±é…¬ï¼šã‚°ãƒ©ã‚¦ãƒ³ãƒ‡ã‚£ãƒ³ã‚°å¼·åº¦UP" },
      { title: "ã€å„€å¼ã€‘æ°´ã®æµ„åŒ–", desc: "æ‰‹ã‚’æ´—ã†æ™‚ã€å†·ãŸã•ã‚’3ç§’é–“ã ã‘å…¨ç¥çµŒã§æ„Ÿã˜å–ã‚Œã€‚<br>å ±é…¬ï¼šæ€è€ƒãƒã‚¤ã‚ºã®å¼·åˆ¶åœæ­¢" },
      { title: "ã€è¨€èªã€‘60ç‚¹ã®å‘ªæ–‡", desc: "å¤±æ•—ã—ãã†ãªæ™‚ã€å¿ƒã®ä¸­ã§ã€Œã¾ã€ã„ã£ã‹ã€ã¨å”±ãˆã‚ˆã€‚<br>å ±é…¬ï¼šå®Œç’§ä¸»ç¾©ã‚´ãƒ¼ãƒ¬ãƒ ã®å¼±ä½“åŒ–" }
    ];

    // é­”ç‰©å›³é‘‘ãƒ‡ãƒ¼ã‚¿
    const MONSTERS = [
      { id: 1, name: "æ²ˆé»™ã®äº¡éœŠ", icon: "ğŸ‘»", desc: "ä¼šè©±ãŒé€”åˆ‡ã‚ŒãŸç¬é–“ã«ç¾ã‚Œã€å¿ƒè‡“ã‚’ç· ã‚ä»˜ã‘ã‚‹ã€‚", weak: "å¼±ç‚¹ï¼šæ°´ã‚’é£²ã‚€ / å¾…ã¤" },
      { id: 2, name: "è¦–ç·šã®çœ¼çƒ", icon: "ğŸ‘", desc: "ã€Œè¦‹ã‚‰ã‚Œã¦ã„ã‚‹ã€ã¨ã„ã†æ„Ÿè¦šã‚’ä½œã‚Šå‡ºã™å¹»å½±ã€‚", weak: "å¼±ç‚¹ï¼šå‘¨è¾ºè¦–é‡ã‚’åºƒã’ã‚‹" },
      { id: 3, name: "å®Œç’§ã®çŸ³åƒ", icon: "ğŸ—¿", desc: "ã€Œã¡ã‚ƒã‚“ã¨ã—ãªãã‚ƒã€ã¨å›ãã€ä½“ã‚’é‡ãã™ã‚‹ã€‚", weak: "å¼±ç‚¹ï¼šã€Œ60ç‚¹ã§ã„ã„ã€ã¨å”±ãˆã‚‹" },
      { id: 4, name: "ç„¦ç‡¥ã®ç‚", icon: "ğŸ”¥", desc: "ç†ç”±ã‚‚ãªãã€Œæ€¥ãŒãªãã‚ƒã€ã¨è„ˆã‚’é€Ÿã‚ã‚‹ã€‚", weak: "å¼±ç‚¹ï¼šè¸µã«é‡å¿ƒã‚’è½ã¨ã™" }
    ];

    // è£…å‚™ãƒ‡ãƒ¼ã‚¿
    const EQUIPMENTS = [
      { id: 1, name: "ãƒ›ãƒ¼ã‚¯ã‚¢ã‚¤ (é ­)", icon: "ğŸ§¢", effect: "å‘¨è¾ºè¦–é‡æ‹¡å¼µ", desc: "é ãã®çœ‹æ¿ã®æ–‡å­—ã‚’3ç§’è¦‹ã‚‹ã€‚ä¸€ç‚¹é›†ä¸­ã‚’è§£é™¤ã—ã€è„³ã®ä¸¦åˆ—å‡¦ç†ã‚’ä¸Šã’ã‚‹ã€‚" },
      { id: 2, name: "é‡åŠ›ã‚¢ãƒ³ã‚«ãƒ¼ (èƒ´)", icon: "ğŸ¥‹", effect: "ä¸å‹•å¿ƒ", desc: "æ¯ã‚’åããªãŒã‚‰ã€ä½“é‡ã‚’è¸µï¼ˆã‹ã‹ã¨ï¼‰ã«è½ã¨ã™ã€‚ä»–äººã®æ„Ÿæƒ…ã«æµã•ã‚Œãªããªã‚‹ã€‚" },
      { id: 3, name: "å†·æ°´ã®è­·ç¬¦ (é£¾)", icon: "ğŸ’§", effect: "è¦šé†’", desc: "æœã€å†·æ°´ã‚’æµ´ã³ã‚‹ã‹ã€æ‰‹é¦–ã‚’å†·ã‚„ã™ã€‚è¿·èµ°ç¥çµŒã‚’åˆºæ¿€ã—ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚" }
    ];

    // === ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚¸ãƒƒã‚¯ ===
    let level = parseInt(localStorage.getItem('grimoire_level')) || 1;
    let exp = parseInt(localStorage.getItem('grimoire_exp')) || 0;
    let maxExp = level * 100;
    
    // åˆæœŸåŒ–
    init();

    function init() {
      updateHud();
      renderMonsters();
      renderEquipments();
      renderKuji();
      checkLoginBonus();
    }

    // ãƒ‡ã‚¤ãƒªãƒ¼ã‚¯ã‚¨ã‚¹ãƒˆè¡¨ç¤º
    function checkLoginBonus() {
      const lastLogin = localStorage.getItem('last_login_date');
      const today = new Date().toDateString();
      
      if (lastLogin !== today) {
        // ãƒ©ãƒ³ãƒ€ãƒ ã«ã‚¯ã‚¨ã‚¹ãƒˆé¸æŠ
        const quest = QUESTS[Math.floor(Math.random() * QUESTS.length)];
        document.getElementById('dailyQuestText').innerHTML = `<strong>${quest.title}</strong><br><br>${quest.desc}`;
        document.getElementById('dailyModal').classList.add('show');
      }
    }

    function acceptQuest() {
      const today = new Date().toDateString();
      localStorage.setItem('last_login_date', today);
      document.getElementById('dailyModal').classList.remove('show');
      addExp(20); // ãƒ­ã‚°ã‚¤ãƒ³ãƒœãƒ¼ãƒŠã‚¹EXP
      alert("ã‚¯ã‚¨ã‚¹ãƒˆã‚’å—æ³¨ã—ã¾ã—ãŸã€‚\nEXP +20 ç²å¾—");
    }

    // EXPåŠ ç®—
    function addExp(amount) {
      exp += amount;
      if (exp >= maxExp) {
        levelUp();
      } else {
        saveData();
      }
      updateHud();
    }

    function levelUp() {
      exp -= maxExp;
      level++;
      maxExp = level * 100;
      saveData();
      document.getElementById('levelupModal').classList.add('show');
    }
    
    function closeLevelUp() {
      document.getElementById('levelupModal').classList.remove('show');
    }

    function updateHud() {
      document.getElementById('currentLevel').innerText = level;
      document.getElementById('expText').innerText = `${exp} / ${maxExp}`;
      document.getElementById('expBar').style.width = `${(exp / maxExp) * 100}%`;
    }

    function saveData() {
      localStorage.setItem('grimoire_level', level);
      localStorage.setItem('grimoire_exp', exp);
    }

    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ç³»
    function renderMonsters() {
      const container = document.getElementById('monsterList');
      container.innerHTML = "";
      MONSTERS.forEach(m => {
        // ã‚¿ãƒƒãƒ—ã§ã€Œè¨ä¼ï¼ˆåé›†ï¼‰ã€ã—ãŸã“ã¨ã«ã™ã‚‹æ¼”å‡º
        const div = document.createElement('div');
        div.className = `monster-card ${localStorage.getItem('monster_'+m.id) ? 'collected' : ''}`;
        div.innerHTML = `
          <div class="monster-icon">${m.icon}</div>
          <div class="monster-name">${m.name}</div>
          <div class="monster-weakness">${m.weak}</div>
        `;
        div.onclick = () => {
          if(!localStorage.getItem('monster_'+m.id)) {
            localStorage.setItem('monster_'+m.id, true);
            div.classList.add('collected');
            addExp(30);
            alert(`${m.name} ã‚’å›³é‘‘ã«ç™»éŒ²ã—ã¾ã—ãŸã€‚\nã€Œå¼±ç‚¹ã€ãŒé–‹ç¤ºã•ã‚Œã¾ã™ã€‚`);
          } else {
            alert(m.desc);
          }
        };
        container.appendChild(div);
      });
    }

    function renderEquipments() {
      const container = document.getElementById('equipmentList');
      container.innerHTML = "";
      EQUIPMENTS.forEach(e => {
        const isEquipped = localStorage.getItem('equip_'+e.id);
        const div = document.createElement('div');
        div.className = 'equip-slot';
        div.innerHTML = `
          <div class="equip-icon">${e.icon}</div>
          <div class="equip-info">
            <div style="font-weight:bold; font-size:14px; color:#eee;">${e.name}</div>
            <div style="font-size:10px; color:#888;">åŠ¹æœ: ${e.effect}</div>
          </div>
          <button class="equip-btn ${isEquipped ? 'equipped' : ''}" onclick="toggleEquip(${e.id}, this)">
            ${isEquipped ? 'E' : 'è£…å‚™'}
          </button>
        `;
        div.onclick = (ev) => { if(ev.target.tagName !== 'BUTTON') alert(e.desc); };
        container.appendChild(div);
      });
    }

    window.toggleEquip = function(id, btn) {
      const key = 'equip_' + id;
      if(localStorage.getItem(key)) {
        localStorage.removeItem(key);
        btn.classList.remove('equipped');
        btn.innerText = "è£…å‚™";
      } else {
        // ä»–ã®åŒã˜éƒ¨ä½ã‚’å¤–ã™å‡¦ç†ã¯çœç•¥ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã«å…¨éƒ¨è£…å‚™å¯èƒ½ã«ã™ã‚‹ï¼‰
        localStorage.setItem(key, true);
        btn.classList.add('equipped');
        btn.innerText = "E";
        addExp(10);
        alert("è£…å‚™ã—ã¾ã—ãŸã€‚\næ„è­˜ãŒæ›¸ãæ›ã‚ã‚Šã¾ã™ã€‚");
      }
    };

    function renderKuji() {
      const chars = ["è‡¨", "å…µ", "é—˜", "è€…", "çš†", "é™£", "çƒˆ", "åœ¨", "å‰"];
      const grid = document.getElementById('kujiGrid');
      let step = 0;
      
      chars.forEach((char, idx) => {
        const cell = document.createElement('div');
        cell.className = 'kuji-cell';
        cell.innerText = char;
        cell.onclick = () => {
          if (idx === step) {
            cell.classList.add('active');
            if(navigator.vibrate) navigator.vibrate(20);
            step++;
            if (step === 9) {
              document.getElementById('kujiLabel').innerText = "ç ´é‚ªé¡•æ­£ï¼šEXP +50";
              addExp(50);
              if(navigator.vibrate) navigator.vibrate([50,50,50]);
              setTimeout(() => {
                document.querySelectorAll('.kuji-cell').forEach(c => c.classList.remove('active'));
                document.getElementById('kujiLabel').innerText = "";
                step = 0;
              }, 1500);
            }
          } else {
            step = 0;
            document.querySelectorAll('.kuji-cell').forEach(c => c.classList.remove('active'));
            if(navigator.vibrate) navigator.vibrate(200);
          }
        };
        grid.appendChild(cell);
      });
    }
  </script>
</body>
</html>
